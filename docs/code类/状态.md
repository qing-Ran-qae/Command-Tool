# 状态

`stat`

可以"标记状态"

## "状态"概念

每个状态是一个"标记"<br>
字面意思，标记一个状态，就像你用`/tag`为实体添加"标记"一样

状态分为多个阶段，不同的阶段有不同的作用(作用由你自己定义)<br>
状态可以在多个阶段之间来回切换，你可以自定义切换次数和切换顺序等

### 阶段内容

所有阶段拥有`开始`、`正在`和`结束`三条可配置的执行指令<br>
分别执行于`进入阶段时` `在此状态的每tick` `进入其他状态时`

#### 执行时许和顺序

<img src="../assets/阶段.png" src="阶段图示执行顺序" title="阶段执行顺序图示"><br>
上图不完全准确，建议自己测一下，但如果没有特殊需求一般对时许要求没那么严格

## 方法

### 添加状态

`add`

添加一个状态

```text
[str][sel]in : 状态作用于谁(as $(in)，如果要at需在bg/of/cl加exe at...)
    none : 无作用实体
    sel : sel类型的值，状态作用的目标实体(必须为实体名或完整选择器)
[[]]stage : 状态的所有阶段
    {} : 一个阶段
        [C]bg : "开始"指令
        [C]of : "正在"指令
        [C]cl : "结束"指令
[{}]info : 此状态的额外信息，如不需要应为空对象
[int]og : 状态创建时处于第几阶段
```

`info`参数用于接入你的系统<br>
在任何状态的`开始`/`正在`/`结束`指令执行时会将其值暂存进`ct:temp `储存中

tip: `in:"none"`有点小 bug，如果`add`函数有执行者的话新状态第一次执行`bg`会让`add`函数的执行者作为`bg`的执行者

### 删除状态

`del`

删除一个状态<br>
更推荐直接使用`data`删除`ct:code.stat inst`中的状态实例

```text
[DS]target : 要删除的事件，匹配一个状态实例
```

### 修改状态

`modify`

修改某个状态的一个键<br>
更推荐直接使用`data`修改`ct:code.stat inst`中的状态实例

```text
[DS]target : 要修改的事件，匹配一个状态实例
[DS]from : 要修改的键
[DS]to : 目标值
```

注：不要用这个方法来跳转阶段，如要改变状态阶段请使用`jump`

### 跳转阶段

`jump`

让某个状态跳转至指定阶段

```
[DS]from : 目标状态，匹配一个状态实例
[int]to : 目标阶段，阶段id等于在stage中的下标
```

在进入其他阶段时，同一 tick 会先执行上阶段的`结束`然后执行下阶段的`开始`

## 状态对象

所有状态实例存在`ct:code.stat inst`中

格式为：

```text
inst: [
    {
        in: "", // 所在的实体
        stage: { // 所有状态
            bg: "",
            of: "",
            cl: ""
        },
        info: {}, // 额外信息
        curr: N // 当前所在阶段
        uuid: [I; xxx,xxx,xxx,xxx] // 用于区分不同实例
    }
]
```